#!/bin/sh
DIR=$(dirname "$0")
cd $DIR/pb
#  --js_out="library=pb_$1,binary:js" \

pbcompile()
{
protoc \
  -I . \
  -I ${GOPATH}/src \
  -I ${GOPATH}/src/github.com/envoyproxy/protoc-gen-validate \
  --go_out="plugins=grpc:../backend/$1/pb/" \
  --validate_out="lang=go:../backend/$1/pb/" \
  $1.proto

../pbclean ./$1.proto > ./$1.clean.proto
}

pbpropague()
{
	cp -r ../backend/$1/pb/pb$1 ../backend/$2/pb/
}

pbcompile users

pbcompile identifier

pbcompile auth

pbcompile mailer

pbpropague auth users

pbpropague identifier users

pbpropague mailer users

echo "Done"
